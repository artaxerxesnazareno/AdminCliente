<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" data-wf-page="6685d2b136a220cb0572694a" data-wf-site="6685d2b136a220cb057268d9">
<head>
  <meta charset="utf-8">
  <title>Editar Perfil</title>
  <meta content="Editar Perfil" property="og:title">
  <meta content="Editar Perfil" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link th:href="@{/css/normalize.css}" rel="stylesheet" type="text/css">
  <link th:href="@{/css/components.css}" rel="stylesheet" type="text/css">
  <link th:href="@{/css/cazio-app.css}" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inter:300,regular,500,600,700","Barlow:100,200,300,regular,500,600,700,800,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link th:href="@{/images/favicon.png}" rel="shortcut icon" type="image/x-icon">
  <link th:href="@{/images/webclip.png}" rel="apple-touch-icon">
</head>
<body>
  <div class="mother-div">
    <div class="criar-page-mobile-menu">
      <a href="javascript:history.back()" class="back-button-wrapper w-inline-block">
        <div class="icon back">
          <div class="main-font-icon">q</div>
        </div>
      </a>
      <div>
        <h1 class="criar-page-title">Editar Perfil</h1>
      </div>
    </div>
    <div class="content">
      <div class="top-section-navigation">
        <a href="javascript:history.back()" class="seta-para-tras w-inline-block">
          <div class="text-block-129">q</div>
        </a>
        <div class="titulo">
          <div class="text-block-130">Editar perfil<br></div>
        </div>
      </div>
      <section class="criar-page-section">
        <div class="container">
          <div class="form-wrapper w-form">
            <form th:action="@{/cazio/utilizadores/editar-perfil}" th:object="${usuarioDTO}" method="post" enctype="multipart/form-data">
              <div class="form-section tighter">
                <div class="criar-content-wrapper">
                  <div class="photo-upload-input-wrapper">
                    <label for="imagem" class="form-field-lable">Imagem</label>
                    <input type="file" id="imagemInput" name="imagemFile" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
                    <input type="hidden" th:field="*{imagemBase64}" id="imagemBase64">
                    <div class="photo-upload-input-field" onclick="document.getElementById('imagemInput').click()">
                      <div class="icon upload-icon">
                        <div class="main-font-icon">4</div>
                      </div>
                      <div class="photo-upload-text">Clique para fazer upload</div>
                      <div class="photo-upload-text small-gray">Ficheiro deve ter menos de 1MB</div>
                    </div>
                    <div id="previewWrapper" class="uploaded-photo-wrapper" th:style="${usuarioDTO.imagemBase64 != null ? 'display: block' : 'display: none'}">
                      <div class="uploaded-photo-content">
                        <div class="uploaded-photo-div">
                          <div class="photo-contain">
                            <img id="imagePreview" th:src="${usuarioDTO.imagemBase64}" alt="Preview">
                          </div>
                        </div>
                      </div>
                      <div class="_3-buttons-wrapper">
                        <a href="#" onclick="document.getElementById('imagemInput').click(); return false;" class="action-button w-inline-block">
                          <div class="icon quick-action">
                            <div class="main-font-icon">w</div>
                            <div class="button-text quick-action-text">Substituir</div>
                          </div>
                        </a>
                        <a href="#" onclick="limparImagem(); return false;" class="action-button w-inline-block">
                          <div class="icon quick-action">
                            <div class="main-font-icon">v</div>
                            <div class="button-text quick-action-text">Eliminar</div>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class="form-field-wrapper">
                    <label for="nome" class="form-field-lable">Nome</label>
                    <input class="form-text-field w-input" maxlength="256" th:field="*{nome}" type="text" required>
                  </div>
                  <div class="form-field-wrapper">
                    <label for="telefone" class="form-field-lable">Nº de telefone</label>
                    <input class="form-text-field w-input" maxlength="256" th:field="*{telefone}" type="text" required>
                  </div>
                  <div class="form-field-wrapper">
                    <label for="email" class="form-field-lable">E-mail</label>
                    <input class="form-text-field w-input" maxlength="256" th:field="*{email}" type="email" readonly>
                  </div>
                  <div class="form-field-wrapper">
                    <label for="senha" class="form-field-lable">Nova Senha (opcional)</label>
                    <input class="form-text-field w-input" maxlength="256" th:field="*{senha}" type="password" id="senha">
                  </div>
                  <div class="form-field-wrapper" id="confirmarSenhaWrapper" style="display: none;">
                    <label for="confirmarSenha" class="form-field-lable">Confirmar Nova Senha</label>
                    <input class="form-text-field w-input" maxlength="256" name="confirmarSenha" type="password" id="confirmarSenha" oninput="validarSenhas()">
                    <div id="senhaError" style="color: red; display: none;">As senhas não coincidem</div>
                  </div>
                  <div class="create-div">
                    <button type="submit" class="button main w-button" id="submitButton">Guardar</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </section>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6685d2b136a220cb057268d9" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../../js/cazio-app.js" type="text/javascript"></script>
  <script>
    function handleImageUpload(input) {
      const file = input.files[0];
      if (file) {
        if (file.size > 1024 * 1024) { // 1MB
          alert('A imagem deve ter menos de 1MB');
          input.value = '';
          return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('imagemBase64').value = e.target.result;
          document.getElementById('imagePreview').src = e.target.result;
          document.getElementById('previewWrapper').style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    function limparImagem() {
      document.getElementById('imagemInput').value = '';
      document.getElementById('imagemBase64').value = '';
      document.getElementById('previewWrapper').style.display = 'none';
    }

    // Mostra o campo de confirmar senha apenas quando uma nova senha é digitada
    document.getElementById('senha').addEventListener('input', function() {
      const confirmarSenhaWrapper = document.getElementById('confirmarSenhaWrapper');
      confirmarSenhaWrapper.style.display = this.value ? 'block' : 'none';
      if (!this.value) {
        document.getElementById('confirmarSenha').value = '';
        document.getElementById('senhaError').style.display = 'none';
        document.getElementById('submitButton').disabled = false;
      }
    });

    function validarSenhas() {
      const senha = document.getElementById('senha').value;
      const confirmarSenha = document.getElementById('confirmarSenha').value;
      const errorDiv = document.getElementById('senhaError');
      const submitButton = document.getElementById('submitButton');

      if (senha && senha !== confirmarSenha) {
        errorDiv.style.display = 'block';
        submitButton.disabled = true;
      } else {
        errorDiv.style.display = 'none';
        submitButton.disabled = false;
      }
    }
  </script>
</body>
</html> 